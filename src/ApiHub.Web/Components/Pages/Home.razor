@page "/"

<PageTitle>Dashboard - ApiHub</PageTitle>

<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title mb-0">Total Requests</h6>
                        <h2 class="mb-0">@_totalRequests</h2>
                    </div>
                    <i class="bi bi-send fs-1 opacity-50"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title mb-0">Success Rate</h6>
                        <h2 class="mb-0">@_successRate%</h2>
                    </div>
                    <i class="bi bi-check-circle fs-1 opacity-50"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title mb-0">Avg Latency</h6>
                        <h2 class="mb-0">@_avgLatency ms</h2>
                    </div>
                    <i class="bi bi-speedometer fs-1 opacity-50"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-dark">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-title mb-0">Active Connectors</h6>
                        <h2 class="mb-0">@_activeConnectors</h2>
                    </div>
                    <i class="bi bi-plug fs-1 opacity-50"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Requests Over Time</h5>
            </div>
            <div class="card-body">
                <canvas id="requestsChart" height="300"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Status Code Distribution</h5>
            </div>
            <div class="card-body">
                <canvas id="statusChart" height="300"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mt-2">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Top Connectors</h5>
                <a href="/connectors" class="btn btn-sm btn-outline-primary">View All</a>
            </div>
            <div class="card-body p-0">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Connector</th>
                            <th>Requests</th>
                            <th>Success Rate</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var connector in _topConnectors)
                        {
                            <tr>
                                <td>@connector.Name</td>
                                <td>@connector.RequestCount</td>
                                <td>
                                    <span class="badge @(connector.SuccessRate >= 95 ? "bg-success" : connector.SuccessRate >= 80 ? "bg-warning" : "bg-danger")">
                                        @connector.SuccessRate%
                                    </span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Recent Requests</h5>
                <a href="/history" class="btn btn-sm btn-outline-primary">View All</a>
            </div>
            <div class="card-body p-0">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Method</th>
                            <th>URL</th>
                            <th>Status</th>
                            <th>Duration</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var request in _recentRequests)
                        {
                            <tr>
                                <td><span class="badge bg-secondary">@request.Method</span></td>
                                <td class="text-truncate" style="max-width: 200px;">@request.Url</td>
                                <td>
                                    <span class="badge @(request.StatusCode < 400 ? "bg-success" : "bg-danger")">
                                        @request.StatusCode
                                    </span>
                                </td>
                                <td>@request.DurationMs ms</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@code {
    private int _totalRequests = 1234;
    private double _successRate = 98.5;
    private int _avgLatency = 245;
    private int _activeConnectors = 5;

    private List<TopConnector> _topConnectors = new()
    {
        new("JSONPlaceholder", 450, 99.1),
        new("Petstore", 320, 97.5),
        new("ReqRes", 280, 95.0),
        new("GitHub API", 120, 100.0),
        new("OpenWeather", 64, 98.4)
    };

    private List<RecentRequest> _recentRequests = new()
    {
        new("GET", "/posts", 200, 123),
        new("POST", "/users", 201, 234),
        new("GET", "/pet/findByStatus", 200, 456),
        new("DELETE", "/posts/1", 200, 89),
        new("GET", "/weather?q=London", 200, 312)
    };

    private record TopConnector(string Name, int RequestCount, double SuccessRate);
    private record RecentRequest(string Method, string Url, int StatusCode, int DurationMs);
}

@page "/reports"

<PageTitle>Reports - ApiHub</PageTitle>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="mb-0">Reports</h4>
    <button class="btn btn-primary" @onclick="ShowGenerateModal">
        <i class="bi bi-plus-lg me-1"></i> Generate Report
    </button>
</div>

<div class="row g-4 mb-4">
    <div class="col-md-4">
        <div class="card bg-light">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="rounded-circle bg-primary p-3 me-3">
                        <i class="bi bi-file-earmark-pdf text-white fs-4"></i>
                    </div>
                    <div>
                        <h6 class="mb-0">PDF Reports</h6>
                        <h3 class="mb-0">24</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card bg-light">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="rounded-circle bg-success p-3 me-3">
                        <i class="bi bi-file-earmark-excel text-white fs-4"></i>
                    </div>
                    <div>
                        <h6 class="mb-0">Excel Reports</h6>
                        <h3 class="mb-0">18</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card bg-light">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="rounded-circle bg-info p-3 me-3">
                        <i class="bi bi-clock-history text-white fs-4"></i>
                    </div>
                    <div>
                        <h6 class="mb-0">Scheduled</h6>
                        <h3 class="mb-0">5</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<ul class="nav nav-tabs mb-3">
    <li class="nav-item">
        <button class="nav-link @(_activeTab == "generated" ? "active" : "")"
                @onclick="@(() => SetActiveTab("generated"))">
            Generated Reports
        </button>
    </li>
    <li class="nav-item">
        <button class="nav-link @(_activeTab == "scheduled" ? "active" : "")"
                @onclick="@(() => SetActiveTab("scheduled"))">
            Scheduled Reports
        </button>
    </li>
    <li class="nav-item">
        <button class="nav-link @(_activeTab == "templates" ? "active" : "")"
                @onclick="@(() => SetActiveTab("templates"))">
            Templates
        </button>
    </li>
</ul>

@if (_activeTab == "generated")
{
    <div class="card">
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Report Name</th>
                        <th>Type</th>
                        <th>Format</th>
                        <th>Generated</th>
                        <th>Size</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var report in _reports)
                    {
                        <tr>
                            <td>
                                <i class="bi @(report.Format == "PDF" ? "bi-file-earmark-pdf text-danger" : "bi-file-earmark-excel text-success") me-2"></i>
                                @report.Name
                            </td>
                            <td>@report.Type</td>
                            <td><span class="badge @(report.Format == "PDF" ? "bg-danger" : "bg-success")">@report.Format</span></td>
                            <td>@report.GeneratedAt.ToString("MMM dd, yyyy HH:mm")</td>
                            <td>@report.Size</td>
                            <td>
                                <button class="btn btn-sm btn-primary" title="Download">
                                    <i class="bi bi-download"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" title="View">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" title="Delete">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
}
else if (_activeTab == "scheduled")
{
    <div class="card">
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Report Name</th>
                        <th>Schedule</th>
                        <th>Format</th>
                        <th>Next Run</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var scheduled in _scheduledReports)
                    {
                        <tr>
                            <td>@scheduled.Name</td>
                            <td><span class="badge bg-secondary">@scheduled.Schedule</span></td>
                            <td>@scheduled.Format</td>
                            <td>@scheduled.NextRun.ToString("MMM dd, yyyy HH:mm")</td>
                            <td>
                                <span class="badge @(scheduled.IsActive ? "bg-success" : "bg-secondary")">
                                    @(scheduled.IsActive ? "Active" : "Paused")
                                </span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" title="Run Now">
                                    <i class="bi bi-play"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" title="Edit">
                                    <i class="bi bi-pencil"></i>
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
}
else
{
    <div class="row g-4">
        @foreach (var template in _templates)
        {
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title">@template.Name</h5>
                        <p class="card-text text-muted">@template.Description</p>
                        <div class="d-flex gap-2">
                            <span class="badge bg-secondary">@template.Category</span>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent">
                        <button class="btn btn-primary btn-sm">Generate</button>
                        <button class="btn btn-outline-secondary btn-sm">Preview</button>
                    </div>
                </div>
            </div>
        }
    </div>
}

@code {
    private string _activeTab = "generated";

    private List<GeneratedReport> _reports = new()
    {
        new("API Activity Report - January 2025", "Activity", "PDF", DateTime.Now.AddDays(-1), "2.4 MB"),
        new("Error Analysis Q4 2024", "Analytics", "Excel", DateTime.Now.AddDays(-3), "1.8 MB"),
        new("Connector Performance Summary", "Performance", "PDF", DateTime.Now.AddDays(-5), "1.2 MB"),
        new("Weekly Status Report", "Status", "PDF", DateTime.Now.AddDays(-7), "856 KB"),
        new("Data Export - All Records", "Export", "Excel", DateTime.Now.AddDays(-10), "5.6 MB")
    };

    private List<ScheduledReport> _scheduledReports = new()
    {
        new("Daily Activity Summary", "Daily", "PDF", DateTime.Now.AddDays(1), true),
        new("Weekly Performance Report", "Weekly", "Excel", DateTime.Now.AddDays(3), true),
        new("Monthly Analytics Digest", "Monthly", "PDF", DateTime.Now.AddDays(15), true),
        new("Error Alert Report", "Daily", "PDF", DateTime.Now.AddDays(1), false)
    };

    private List<ReportTemplate> _templates = new()
    {
        new("API Activity Report", "Detailed breakdown of all API requests", "Activity"),
        new("Error Analysis", "Analysis of failed requests and error patterns", "Analytics"),
        new("Performance Summary", "Response times and throughput metrics", "Performance"),
        new("Connector Comparison", "Side-by-side connector statistics", "Comparison"),
        new("Data Export", "Export all records to Excel", "Export"),
        new("Audit Log Report", "Security and compliance audit trail", "Audit")
    };

    private void ShowGenerateModal()
    {
        // TODO: Implement modal
    }

    private void SetActiveTab(string tab)
    {
        _activeTab = tab;
    }

    private record GeneratedReport(string Name, string Type, string Format, DateTime GeneratedAt, string Size);
    private record ScheduledReport(string Name, string Schedule, string Format, DateTime NextRun, bool IsActive);
    private record ReportTemplate(string Name, string Description, string Category);
}
